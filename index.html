<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ö—Ä–∞—Å–∫–∏ –†–∞—Å—Å–≤–µ—Ç–∞ ‚Äî Music Hub</title>

  <style>
    :root{
      --s: 1.05;                 /* –º–∞—Å—à—Ç–∞–± UI */
      --bg:#070914;
      --panel: rgba(14,16,28,.86);
      --stroke: rgba(255,255,255,.07);
      --text:#f1f3ff;
      --muted:#a7abc8;

      /* –∞–∫—Ü–µ–Ω—Ç */
      --accent:#ffb347;          /* –º–µ–Ω—è–µ—Ç—Å—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö */
      --pink:#ff6fae;
      --sky:#6ecbff;

      --r: calc(16px * var(--s));
      --pad: calc(12px * var(--s));
      --gap: calc(12px * var(--s));
      --blur: 12px;

      --playerH: calc(96px * var(--s));

      /* —ç—Ñ—Ñ–µ–∫—Ç—ã */
      --sunriseOn: 1;            /* 0/1 */
      --sunrisePower: .70;       /* 0..1 */
      --rainOn: 0;               /* 0/1 */
      --rainCount: 26;           /* 0..120 */
      --bgPreset: 1;             /* 1..4 */
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background: var(--bg);
      overflow:hidden;
    }

    /* ===== BACKGROUND PRESETS ===== */
    .bg{
      position:fixed; inset:0; z-index:0;
      background: var(--bg);
    }

    .bg::before{
      content:"";
      position:absolute; inset:0;
      opacity: 1;
      background:
        radial-gradient(1100px 700px at 18% -10%, color-mix(in srgb, var(--accent) 40%, transparent), transparent 60%),
        radial-gradient(900px 620px at 92% 10%, color-mix(in srgb, var(--sky) 28%, transparent), transparent 62%),
        radial-gradient(800px 520px at 50% 92%, color-mix(in srgb, var(--pink) 22%, transparent), transparent 68%),
        linear-gradient(180deg, rgba(255,255,255,.02), transparent 35%),
        var(--bg);
      filter:saturate(1.08) contrast(1.04);
    }

    /* –ø—Ä–µ—Å–µ—Ç—ã (–º–µ–Ω—è–µ–º —á–µ—Ä–µ–∑ data –∞—Ç—Ä–∏–±—É—Ç –Ω–∞ body) */
    body[data-bg="1"] .bg::before{
      background:
        radial-gradient(1100px 700px at 18% -10%, color-mix(in srgb, var(--accent) 40%, transparent), transparent 60%),
        radial-gradient(900px 620px at 92% 10%, color-mix(in srgb, var(--sky) 28%, transparent), transparent 62%),
        radial-gradient(800px 520px at 50% 92%, color-mix(in srgb, var(--pink) 22%, transparent), transparent 68%),
        linear-gradient(180deg, rgba(255,255,255,.02), transparent 35%),
        var(--bg);
    }
    body[data-bg="2"] .bg::before{
      background:
        radial-gradient(1000px 700px at 20% 0%, rgba(255,179,71,.30), transparent 60%),
        radial-gradient(980px 520px at 80% 10%, rgba(255,111,174,.22), transparent 62%),
        radial-gradient(900px 520px at 50% 100%, rgba(110,203,255,.18), transparent 68%),
        radial-gradient(700px 380px at 40% 40%, rgba(255,255,255,.03), transparent 70%),
        var(--bg);
    }
    body[data-bg="3"] .bg::before{
      background:
        radial-gradient(1000px 700px at 10% 0%, rgba(110,203,255,.26), transparent 60%),
        radial-gradient(980px 520px at 90% 10%, rgba(255,179,71,.22), transparent 62%),
        radial-gradient(900px 520px at 50% 100%, rgba(255,111,174,.16), transparent 68%),
        linear-gradient(180deg, rgba(255,255,255,.02), transparent 45%),
        var(--bg);
    }
    body[data-bg="4"] .bg::before{
      background:
        radial-gradient(1000px 640px at 30% -10%, rgba(255,111,174,.26), transparent 62%),
        radial-gradient(900px 540px at 75% 10%, rgba(110,203,255,.18), transparent 62%),
        radial-gradient(980px 680px at 50% 110%, rgba(255,179,71,.20), transparent 66%),
        radial-gradient(800px 520px at 20% 60%, rgba(255,255,255,.03), transparent 70%),
        var(--bg);
    }

    /* ===== SUNRISE OVERLAY (–º–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–∞—Å—Å–≤–µ—Ç) ===== */
    .sunrise{
      position:fixed; inset:-18%; z-index:1;
      pointer-events:none;
      opacity: calc(var(--sunriseOn) * var(--sunrisePower));
      background:
        radial-gradient(900px 420px at 26% 10%, color-mix(in srgb, var(--accent) 42%, transparent), transparent 62%),
        radial-gradient(780px 380px at 72% 18%, color-mix(in srgb, var(--pink) 34%, transparent), transparent 66%),
        radial-gradient(900px 560px at 50% 100%, color-mix(in srgb, var(--sky) 26%, transparent), transparent 72%);
      animation: sunriseMove 18s ease-in-out infinite;
      filter: blur(.6px);
      transform-origin:50% 50%;
    }
    @keyframes sunriseMove{
      0%   { transform: translate3d(-1.4%, -1.0%, 0) scale(1.02); }
      50%  { transform: translate3d( 1.6%,  1.2%, 0) scale(1.05); }
      100% { transform: translate3d(-1.4%, -1.0%, 0) scale(1.02); }
    }

    /* ===== RAIN LAYER ===== */
    .rain{
      position:fixed; inset:0; z-index:2;
      pointer-events:none;
      opacity: calc(.95 * var(--rainOn));
      overflow:hidden;
      mix-blend-mode: screen;
    }
    .drop{
      position:absolute;
      top:-25vh;
      width: 2px;
      height: 18vh;
      background: linear-gradient(to bottom, transparent, rgba(200,240,255,.32), transparent);
      border-radius: 999px;
      animation: fall linear infinite;
      filter: blur(.2px);
    }
    @keyframes fall{
      to { transform: translateY(150vh); }
    }

    /* ===== APP LAYOUT ===== */
    .app{
      position:relative;
      z-index:3;
      height:100%;
      display:grid;
      grid-template-columns: calc(270px * var(--s)) 1fr;
      grid-template-rows: 1fr var(--playerH);
      gap: var(--gap);
      padding: var(--pad);
    }

    .panel{
      background: var(--panel);
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      backdrop-filter: blur(var(--blur));
      -webkit-backdrop-filter: blur(var(--blur));
      box-shadow: 0 18px 56px rgba(0,0,0,.58);
      overflow:hidden;
    }

    /* ===== SIDEBAR ===== */
    .sidebar{
      padding: calc(14px * var(--s));
      display:flex;
      flex-direction:column;
      gap: calc(14px * var(--s));
    }
    .logo{
      font-weight: 950;
      font-size: calc(18px * var(--s));
      letter-spacing:.2px;
      background: linear-gradient(90deg, var(--accent), var(--pink));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      user-select:none;
    }

    .nav{
      display:flex;
      flex-direction:column;
      gap: calc(10px * var(--s));
    }
    .nav button{
      width:100%;
      border:none;
      background: transparent;
      color: var(--text);
      padding: calc(12px * var(--s)) calc(12px * var(--s));
      border-radius: calc(12px * var(--s));
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border: 1px solid transparent;
      font-weight: 850;
      font-size: calc(13px * var(--s));
    }
    .nav button:hover{
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.05);
    }
    .nav button.active{
      background: linear-gradient(90deg, color-mix(in srgb, var(--accent) 24%, transparent), color-mix(in srgb, var(--pink) 14%, transparent));
      border-color: color-mix(in srgb, var(--accent) 34%, transparent);
    }
    .k{
      font-size: calc(11px * var(--s));
      color: rgba(255,255,255,.68);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      padding: 3px 8px;
      border-radius: 999px;
      flex:0 0 auto;
    }

    .hint{
      margin-top:auto;
      padding: calc(10px * var(--s));
      border-radius: calc(12px * var(--s));
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.72);
      font-weight: 650;
      font-size: calc(11px * var(--s));
      line-height: 1.35;
    }

    /* ===== MAIN ===== */
    .main{
      display:flex;
      flex-direction:column;
    }
    .topbar{
      padding: calc(12px * var(--s));
      border-bottom: 1px solid rgba(255,255,255,.06);
      display:flex;
      gap: calc(10px * var(--s));
      align-items:center;
    }
    .search{
      flex:1;
      display:flex;
      align-items:center;
      gap: 10px;
      padding: calc(10px * var(--s)) calc(12px * var(--s));
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 999px;
    }
    .search input{
      width:100%;
      border:none;
      outline:none;
      background: transparent;
      color: var(--text);
      font-size: calc(13px * var(--s));
      font-weight: 750;
    }
    .chip{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.90);
      border-radius: 999px;
      padding: calc(9px * var(--s)) calc(12px * var(--s));
      font-weight: 900;
      font-size: calc(12px * var(--s));
      cursor:pointer;
      user-select:none;
    }
    .chip:hover{ background: rgba(255,255,255,.07); }

    .content{
      padding: calc(14px * var(--s));
      overflow:auto;
    }
    .hero{
      padding: calc(18px * var(--s));
      border-radius: calc(18px * var(--s));
      border: 1px solid rgba(255,255,255,.08);
      background:
        radial-gradient(760px 300px at 24% 0%, color-mix(in srgb, var(--accent) 22%, transparent), transparent 62%),
        radial-gradient(680px 300px at 78% 0%, color-mix(in srgb, var(--sky) 18%, transparent), transparent 66%),
        rgba(255,255,255,.03);
    }
    .hero h1{
      margin:0;
      font-size: calc(22px * var(--s));
      letter-spacing:.2px;
    }
    .hero p{
      margin: 6px 0 0;
      color: rgba(255,255,255,.72);
      font-weight: 650;
      font-size: calc(12px * var(--s));
    }

    .section{ margin-top: calc(16px * var(--s)); }
    .sectionHead{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: calc(10px * var(--s));
    }
    .sectionHead h2{
      margin:0;
      font-size: calc(15px * var(--s));
      font-weight: 950;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(calc(170px * var(--s)), 1fr));
      gap: calc(12px * var(--s));
    }

    .card{
      position:relative;
      padding: calc(10px * var(--s));
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: calc(14px * var(--s));
      cursor:pointer;
      transition: .15s ease;
      user-select:none;
    }
    .card:hover{
      transform: translateY(-2px);
      background: rgba(255,255,255,.07);
      border-color: rgba(255,255,255,.10);
    }
    .cover{
      width:100%;
      aspect-ratio: 1/1;
      border-radius: calc(12px * var(--s));
      background: linear-gradient(135deg, var(--accent), var(--pink), var(--sky));
    }
    .card h3{
      margin: calc(8px * var(--s)) 2px 0;
      font-size: calc(13px * var(--s));
      font-weight: 950;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .card span{
      display:block;
      margin: 3px 2px 0;
      font-size: calc(11px * var(--s));
      color: rgba(255,255,255,.68);
      font-weight: 650;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.08);
      color: rgba(255,255,255,.86);
      font-weight: 850;
      font-size: calc(12px * var(--s));
      cursor:pointer;
      user-select:none;
    }

    /* ===== EMBED PLAYER (ONE ACTIVE) ===== */
    .embedBox{
      margin-top: calc(14px * var(--s));
      padding: calc(12px * var(--s));
      border-radius: calc(16px * var(--s));
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }
    .embedBox h3{
      margin: 0 0 10px 0;
      font-size: calc(14px * var(--s));
      font-weight: 950;
    }
    .embedGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: calc(12px * var(--s));
      align-items:start;
    }
    .embedList{
      display:flex;
      flex-direction:column;
      gap: calc(10px * var(--s));
    }
    .embedItem{
      padding: calc(10px * var(--s));
      border-radius: calc(14px * var(--s));
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.14);
      cursor:pointer;
      user-select:none;
    }
    .embedItem:hover{ background: rgba(255,255,255,.06); }
    .embedItem.active{
      border-color: color-mix(in srgb, var(--accent) 34%, transparent);
      background: linear-gradient(90deg, color-mix(in srgb, var(--accent) 16%, transparent), rgba(255,255,255,.05));
    }
    .embedItem .t{
      font-weight: 950;
      font-size: calc(13px * var(--s));
      margin-bottom: 4px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .embedItem .d{
      color: rgba(255,255,255,.70);
      font-weight: 650;
      font-size: calc(11px * var(--s));
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .embedStage{
      border-radius: calc(14px * var(--s));
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.18);
      overflow:hidden;
    }
    .embedStage iframe{
      width:100%;
      height: calc(220px * var(--s));
      border:0;
      display:block;
    }

    /* ===== SETTINGS UI ===== */
    .settingsGrid{
      margin-top: calc(14px * var(--s));
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: calc(12px * var(--s));
    }
    .group{
      padding: calc(12px * var(--s));
      border-radius: calc(16px * var(--s));
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }
    .group h3{
      margin:0 0 10px 0;
      font-size: calc(14px * var(--s));
      font-weight: 950;
    }
    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      margin-top: 10px;
      color: rgba(255,255,255,.86);
      font-weight: 750;
      font-size: calc(12px * var(--s));
    }
    .row input[type="range"]{ width: 56%; }
    .row input[type="color"]{
      width: 46px; height: 34px;
      border:none; padding:0; background: transparent;
    }
    .note{
      margin-top: 10px;
      color: rgba(255,255,255,.65);
      font-size: calc(11px * var(--s));
      line-height: 1.35;
    }

    /* ===== PLAYER ===== */
    .player{
      grid-column: 1 / span 2;
      grid-row:2;
      padding: calc(12px * var(--s)) calc(14px * var(--s));
      display:grid;
      grid-template-columns: 1.1fr 1.4fr 1.1fr;
      align-items:center;
      gap: calc(12px * var(--s));
    }
    .now{
      display:flex;
      align-items:center;
      gap: calc(10px * var(--s));
      min-width:0;
    }
    .art{
      width: calc(54px * var(--s));
      height: calc(54px * var(--s));
      border-radius: calc(14px * var(--s));
      background: linear-gradient(135deg, rgba(255,255,255,.08), color-mix(in srgb, var(--accent) 22%, transparent));
      border: 1px solid rgba(255,255,255,.10);
      flex:0 0 auto;
    }
    .meta{ min-width:0; }
    .track{
      font-weight: 950;
      font-size: calc(13px * var(--s));
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .artist{
      margin-top: 4px;
      font-weight: 700;
      font-size: calc(11px * var(--s));
      color: rgba(255,255,255,.68);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    .center{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: calc(8px * var(--s));
    }
    .ctrls{
      display:flex;
      align-items:center;
      gap: calc(10px * var(--s));
    }
    .btn{
      width: calc(38px * var(--s));
      height: calc(38px * var(--s));
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      cursor:pointer;
      display:grid;
      place-items:center;
      font-weight: 900;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.08); }
    .btn.play{
      width: calc(42px * var(--s));
      height: calc(42px * var(--s));
      background: var(--accent);
      border-color: color-mix(in srgb, var(--accent) 38%, transparent);
      color:#151515;
    }

    .bar{
      width: min(calc(560px * var(--s)), 100%);
      display:flex;
      align-items:center;
      gap: calc(10px * var(--s));
      font-size: calc(11px * var(--s));
      color: rgba(255,255,255,.70);
      font-weight: 750;
    }
    .prog{
      flex:1;
      height: calc(6px * var(--s));
      border-radius: 999px;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(0,0,0,.35);
      overflow:hidden;
      cursor:pointer;
    }
    .prog > i{
      display:block;
      height:100%;
      width: 0%;
      background: rgba(255,255,255,.75);
      border-radius: 999px;
    }

    .right{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap: calc(10px * var(--s));
    }
    .vol{
      width: calc(130px * var(--s));
      height: calc(6px * var(--s));
      border-radius: 999px;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(0,0,0,.35);
      overflow:hidden;
      cursor:pointer;
    }
    .vol > i{
      display:block;
      height:100%;
      width: 55%;
      background: rgba(255,255,255,.70);
      border-radius: 999px;
    }

    /* scroll */
    .content::-webkit-scrollbar{ width: 10px; }
    .content::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.10);
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,0);
      background-clip: padding-box;
    }

    /* mobile */
    @media (max-width: 980px){
      body{ overflow:auto; }
      .app{
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr var(--playerH);
      }
      .player{
        grid-template-columns: 1fr;
      }
      .right{ justify-content:center; }
      .embedGrid{ grid-template-columns: 1fr; }
      .settingsGrid{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body data-bg="1">
  <div class="bg"></div>
  <div class="sunrise"></div>
  <div class="rain" id="rain"></div>

  <div class="app">
    <!-- SIDEBAR -->
    <aside class="panel sidebar" id="sidebar">
      <div class="logo">–ö—Ä–∞—Å–∫–∏ –†–∞—Å—Å–≤–µ—Ç–∞</div>

      <div class="nav" id="nav">
        <button class="active" data-page="home">üè† –ì–ª–∞–≤–Ω–∞—è <span class="k">1</span></button>
        <button data-page="search">üîç –ü–æ–∏—Å–∫ <span class="k">2</span></button>
        <button data-page="playlists">üéµ –ü–ª–µ–π–ª–∏—Å—Ç—ã <span class="k">3</span></button>
        <button data-page="library">üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ <span class="k">4</span></button>
        <button data-page="settings">‚öô –ù–∞—Å—Ç—Ä–æ–π–∫–∏ <span class="k">5</span></button>
      </div>

      <div class="hint">
        –ë–∏–Ω–¥—ã: 1‚Äì5 (–≤–∫–ª–∞–¥–∫–∏)<br/>
        Space: play/pause (–¥–ª—è –≤—Å—Ç—Ä–æ–π–∫–∏ ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ ‚Äú–∞–∫—Ç–∏–≤–Ω–æ–≥–æ‚Äù —Ç—Ä–µ–∫–∞)<br/>
        –ï—Å–ª–∏ –ø–µ—á–∞—Ç–∞–µ—à—å: Alt+1..5
      </div>
    </aside>

    <!-- MAIN -->
    <main class="panel main">
      <div class="topbar">
        <div class="search">
          <span>üîç</span>
          <input id="searchInput" placeholder="–ü–æ–∏—Å–∫ (–¥–µ–º–æ)" autocomplete="off" />
        </div>
        <div class="chip" id="goSettings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
      </div>

      <div class="content" id="content">
        <!-- HOME -->
        <section id="page-home">
          <div class="hero">
            <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</h1>
            <p>–≠—Ç–æ –¥–µ–º–æ-–≤–µ—Ä—Å–∏—è ‚Äú–∫–∞–∫ Spotify‚Äù, –Ω–æ —Å —Ä–∞—Å—Å–≤–µ—Ç–Ω–æ–π —ç—Å—Ç–µ—Ç–∏–∫–æ–π –∏ –±—ã—Å—Ç—Ä—ã–º–∏ –±–∏–Ω–¥-–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è–º–∏.</p>
          </div>

          <div class="section">
            <div class="sectionHead">
              <h2>–î–ª—è —Ç–µ–±—è</h2>
              <div class="pill" id="stopAllBtn">‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</div>
            </div>
            <div class="grid" id="homeGrid"></div>
          </div>

          <div class="embedBox">
            <h3>–¢—Ä–µ–∫–∏ –Ω–∞ —Å–∞–π—Ç–µ (—á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–π–∫—É). –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏–≥—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω</h3>
            <div class="embedGrid">
              <div class="embedList" id="embedList"></div>
              <div class="embedStage" id="embedStage"></div>
            </div>

            <div class="note">
              –î–æ–±–∞–≤–ª—è—Ç—å ‚Äú–º–Ω–æ–≥–æ –ø–µ—Å–µ–Ω‚Äù —Ä–µ–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ embed-—Å—Å—ã–ª–∫–∏ (Spotify/YouTube/SoundCloud). ‚Äú–í—ã—Ç—è–Ω—É—Ç—å –∞—É–¥–∏–æ‚Äù –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞–ø—Ä—è–º—É—é –æ–±—ã—á–Ω–æ –Ω–µ–ª—å–∑—è.
              –î–∞–ª—å—à–µ, –∫–æ–≥–¥–∞ –ø–æ–¥–∫–ª—é—á–∏–º Firebase, –ª—é–¥–∏ —Å–º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–≤–æ–∏ mp3/wav –∏ —ç—Ç–æ –±—É–¥–µ—Ç —É–∂–µ –Ω–∞—Å—Ç–æ—è—â–∏–π —Ç–≤–æ–π –ø–ª–µ–µ—Ä.
            </div>
          </div>
        </section>

        <!-- SEARCH -->
        <section id="page-search" style="display:none">
          <div class="hero">
            <h1>–ü–æ–∏—Å–∫</h1>
            <p>–≠—Ç–æ –≤–∫–ª–∞–¥–∫–∞. –ü–æ–∏—Å–∫ —Å–¥–µ–ª–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–º, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –±–∞–∑–∞ (Firebase). –ü–æ–∫–∞ –¥–µ–º–æ-—Å—Ç—Ä–æ–∫–∞.</p>
          </div>
        </section>

        <!-- PLAYLISTS -->
        <section id="page-playlists" style="display:none">
          <div class="hero">
            <h1>–ü–ª–µ–π–ª–∏—Å—Ç—ã</h1>
            <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∫ —É Spotify: —Å–ø–∏—Å–æ–∫ + —Ç—Ä–µ–∫–∏ + —Ñ–∏–ª—å—Ç—Ä—ã. –ü–æ–∫–∞ –¥–µ–º–æ.</p>
          </div>
        </section>

        <!-- LIBRARY -->
        <section id="page-library" style="display:none">
          <div class="hero">
            <h1>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</h1>
            <p>–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ. –ü–æ–∑–∂–µ –¥–æ–±–∞–≤–∏–º –ª–∞–π–∫–∏/–∏—Å—Ç–æ—Ä–∏—é/—Å–∫–∞—á–∞–Ω–Ω—ã–µ.</p>
          </div>
        </section>

        <!-- SETTINGS -->
        <section id="page-settings" style="display:none">
          <div class="hero">
            <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
            <p>–†–∞–∑–º–µ—Ä UI, –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç, —Ñ–æ–Ω, —Ä–∞—Å—Å–≤–µ—Ç, –¥–æ–∂–¥—å.</p>
          </div>

          <div class="settingsGrid">
            <div class="group">
              <h3>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h3>

              <div class="row">
                <span>–ú–∞—Å—à—Ç–∞–± UI</span>
                <input id="uiScale" type="range" min="0.80" max="1.60" step="0.01" value="1.05">
              </div>

              <div class="row">
                <span>–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç</span>
                <input id="accent" type="color" value="#ffb347">
              </div>

              <div class="note">
                –í—Å—ë —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
              </div>
            </div>

            <div class="group">
              <h3>–≠—Ñ—Ñ–µ–∫—Ç—ã</h3>

              <div class="row">
                <span>–†–∞—Å—Å–≤–µ—Ç (–≤–∫–ª)</span>
                <input id="sunriseOn" type="range" min="0" max="1" step="1" value="1">
              </div>

              <div class="row">
                <span>–°–∏–ª–∞ —Ä–∞—Å—Å–≤–µ—Ç–∞</span>
                <input id="sunrisePower" type="range" min="0" max="1" step="0.01" value="0.70">
              </div>

              <div class="row">
                <span>–î–æ–∂–¥—å (–≤–∫–ª)</span>
                <input id="rainOn" type="range" min="0" max="1" step="1" value="0">
              </div>

              <div class="row">
                <span>–ö–∞–ø–µ–ª—å (–∫–æ–ª-–≤–æ)</span>
                <input id="rainCount" type="range" min="0" max="120" step="1" value="26">
              </div>

              <div class="row">
                <span>–§–æ–Ω (–ø—Ä–µ—Å–µ—Ç)</span>
                <input id="bgPreset" type="range" min="1" max="4" step="1" value="1">
              </div>

              <div class="note">
                –î–æ–∂–¥—å ‚Äî —á–∏—Å—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω–æ, –∫–ª–∏–∫–∞–º –Ω–µ –º–µ—à–∞–µ—Ç.
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- PLAYER (—Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ–≥–æ embed) -->
    <footer class="panel player">
      <div class="now">
        <div class="art"></div>
        <div class="meta">
          <div class="track" id="trackName">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç—Ä–µ–∫–∞</div>
          <div class="artist" id="artistName">–í—ã–±–µ—Ä–∏ —Ç—Ä–µ–∫ –∏–∑ —Å–ø–∏—Å–∫–∞</div>
        </div>
      </div>

      <div class="center">
        <div class="ctrls">
          <button class="btn" id="prevBtn" title="–ù–∞–∑–∞–¥ (–≤ —Å–ø–∏—Å–∫–µ)">‚èÆ</button>
          <button class="btn play" id="playBtn" title="–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π">‚ñ∂</button>
          <button class="btn" id="nextBtn" title="–í–ø–µ—Ä—ë–¥ (–≤ —Å–ø–∏—Å–∫–µ)">‚è≠</button>
        </div>
        <div class="bar">
          <span>‚Äî</span>
          <div class="prog"><i id="progFill"></i></div>
          <span>‚Äî</span>
        </div>
      </div>

      <div class="right">
        <button class="btn" id="stopBtn" title="–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å">‚èπ</button>
        <div class="vol" title="(–≤–∏–∑—É–∞–ª—å–Ω–æ)"><i id="volFill"></i></div>
      </div>
    </footer>
  </div>

  <script>
    const $ = (s) => document.querySelector(s);
    const root = document.documentElement;

    // ===== NAV + PAGES =====
    const pages = ["home","search","playlists","library","settings"];
    let pageIndex = 0;

    function setActiveNav(name){
      document.querySelectorAll("#nav button").forEach(btn=>{
        btn.classList.toggle("active", btn.dataset.page === name);
      });
    }

    function openPage(name){
      pages.forEach(p=>{
        const el = document.getElementById("page-"+p);
        if(el) el.style.display = (p === name) ? "block" : "none";
      });
      pageIndex = Math.max(0, pages.indexOf(name));
      setActiveNav(name);

      if(name === "search"){
        $("#searchInput")?.focus();
      }
    }

    // –∫–ª–∏–∫–∏ –ø–æ –º–µ–Ω—é
    document.querySelectorAll("#nav button[data-page]").forEach(btn=>{
      btn.addEventListener("click", () => openPage(btn.dataset.page));
    });

    // –∫–Ω–æ–ø–∫–∞ –≤ —Ç–æ–ø–±–∞—Ä–µ
    $("#goSettings").addEventListener("click", () => openPage("settings"));

    // –±–∏–Ω–¥—ã 1-5
    document.addEventListener("keydown", (e) => {
      const tag = (document.activeElement?.tagName || "").toLowerCase();
      const typing = tag === "input" || tag === "textarea" || document.activeElement?.isContentEditable;

      const allow = !typing || e.altKey; // –µ—Å–ª–∏ –ø–µ—á–∞—Ç–∞–µ—à—å ‚Äî Alt+1..5
      if(!allow) return;

      const k = e.key;
      if(k === "1") openPage("home");
      if(k === "2") openPage("search");
      if(k === "3") openPage("playlists");
      if(k === "4") openPage("library");
      if(k === "5") openPage("settings");
    });

    // ===== CARDS =====
    const demoPlaylists = [
      { title: "Sunrise Chill", desc: "–ü–ª–µ–π–ª–∏—Å—Ç" },
      { title: "Morning Energy", desc: "–ü–ª–µ–π–ª–∏—Å—Ç" },
      { title: "Golden Hour", desc: "–ü–ª–µ–π–ª–∏—Å—Ç" },
      { title: "Night Ride", desc: "–ü–ª–µ–π–ª–∏—Å—Ç" },
      { title: "Soft Pop", desc: "–ü–ª–µ–π–ª–∏—Å—Ç" },
      { title: "Dream Flow", desc: "–ü–ª–µ–π–ª–∏—Å—Ç" },
      { title: "Warm Sky", desc: "–ü–æ–¥–±–æ—Ä–∫–∞" },
      { title: "After Rain", desc: "–ü–æ–¥–±–æ—Ä–∫–∞" }
    ];

    const homeGrid = $("#homeGrid");
    demoPlaylists.forEach(item=>{
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="cover"></div>
        <h3>${escapeHtml(item.title)}</h3>
        <span>${escapeHtml(item.desc)}</span>
      `;
      homeGrid.appendChild(card);
    });

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ===== EMBED PLAYER: ONLY ONE ACTIVE =====
    // –ú–æ–∂–µ—à—å —Å—é–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–∫–æ–ª—å–∫–æ —Ö–æ—á–µ—à—å embed-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.
    // Spotify: https://open.spotify.com/embed/track/...
    // YouTube: https://www.youtube.com/embed/VIDEO_ID
    // SoundCloud: –æ–±—ã—á–Ω–æ –Ω—É–∂–µ–Ω —Å–ø–µ—Ü embed url (–æ–Ω–∏ –¥–∞—é—Ç –∫–æ–¥).
    const embedItems = [
      {
        title: "Daft Punk ‚Äî Harder, Better, Faster, Stronger",
        source: "Spotify Embed",
        url: "https://open.spotify.com/embed/track/5W3cjX2J3tjhG8zb6u0qHn"
      },
      {
        title: "Radiohead ‚Äî Creep",
        source: "Spotify Embed",
        url: "https://open.spotify.com/embed/track/70LcF31zb1H0PyJoS1Sx1r"
      },
      {
        title: "Rick Astley ‚Äî Never Gonna Give You Up",
        source: "YouTube Embed",
        url: "https://www.youtube.com/embed/dQw4w9WgXcQ"
      },
      {
        title: "Coldplay ‚Äî Viva La Vida",
        source: "YouTube Embed",
        url: "https://www.youtube.com/embed/dvgZkm1xWPE"
      }
    ];

    const embedList = $("#embedList");
    const embedStage = $("#embedStage");

    let activeEmbedIndex = -1;

    function renderEmbedList(){
      embedList.innerHTML = "";
      embedItems.forEach((it, idx) => {
        const el = document.createElement("div");
        el.className = "embedItem" + (idx === activeEmbedIndex ? " active" : "");
        el.innerHTML = `
          <div class="t">${escapeHtml(it.title)}</div>
          <div class="d">${escapeHtml(it.source)}</div>
        `;
        el.addEventListener("click", () => setActiveEmbed(idx, true));
        embedList.appendChild(el);
      });
    }

    // –í–ê–ñ–ù–û: —á—Ç–æ–±—ã —Å—Ç–∞—Ä—ã–π —Ç—Ä–µ–∫ —Ç–æ—á–Ω–æ –ø—Ä–µ–∫—Ä–∞—â–∞–ª—Å—è,
    // –º—ã –ù–ï –º–µ–Ω—è–µ–º src —É —Ç–æ–≥–æ –∂–µ iframe, –∞ –ü–ï–†–ï–°–û–ó–î–ê–Å–ú iframe —É–∑–µ–ª.
    function setActiveEmbed(idx, userAction){
      if(idx < 0 || idx >= embedItems.length) return;
      activeEmbedIndex = idx;

      // –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ (–ø–æ–¥—Å–≤–µ—Ç–∫–∞)
      renderEmbedList();

      // —É–±–∏—Ç—å —Å—Ç–∞—Ä—ã–π –ø–ª–µ–µ—Ä
      embedStage.innerHTML = "";

      // —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π iframe
      const it = embedItems[idx];
      const iframe = document.createElement("iframe");
      iframe.setAttribute("allow", "autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture");
      iframe.setAttribute("loading", "lazy");
      iframe.src = it.url;

      embedStage.appendChild(iframe);

      // –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∏–∂–Ω–∏–π –±–∞—Ä
      $("#trackName").textContent = it.title;
      $("#artistName").textContent = it.source;

      // –≤–∏–∑—É–∞–ª—å–Ω–∞—è ‚Äú–ø–æ–ª–æ—Å–∞‚Äù
      $("#progFill").style.width = userAction ? "12%" : "0%";
    }

    function stopEmbed(){
      // ‚Äú—Å—Ç–æ–ø‚Äù = —Å–Ω–µ—Å—Ç–∏ iframe
      embedStage.innerHTML = "";
      activeEmbedIndex = -1;
      renderEmbedList();
      $("#trackName").textContent = "–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ";
      $("#artistName").textContent = "–í—ã–±–µ—Ä–∏ —Ç—Ä–µ–∫ –∏–∑ —Å–ø–∏—Å–∫–∞";
      $("#progFill").style.width = "0%";
    }

    // –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–º
    $("#prevBtn").addEventListener("click", () => {
      if(embedItems.length === 0) return;
      const next = (activeEmbedIndex <= 0) ? (embedItems.length - 1) : (activeEmbedIndex - 1);
      setActiveEmbed(next, true);
    });

    $("#nextBtn").addEventListener("click", () => {
      if(embedItems.length === 0) return;
      const next = (activeEmbedIndex < 0) ? 0 : ((activeEmbedIndex + 1) % embedItems.length);
      setActiveEmbed(next, true);
    });

    $("#playBtn").addEventListener("click", () => {
      // –¥–ª—è embed –Ω–µ—Ç ‚Äúplay/pause‚Äù –Ω–∞–ø—Ä—è–º—É—é –±–µ–∑ API.
      // –¥–µ–ª–∞–µ–º ‚Äú–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π‚Äù: –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º iframe
      if(activeEmbedIndex < 0) {
        setActiveEmbed(0, true);
        return;
      }
      setActiveEmbed(activeEmbedIndex, true);
    });

    $("#stopBtn").addEventListener("click", stopEmbed);
    $("#stopAllBtn").addEventListener("click", stopEmbed);

    // Space: –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫/—Å—Ç–æ–ø (—á—Ç–æ–±—ã –±—ã–ª–æ —É–¥–æ–±–Ω–æ)
    document.addEventListener("keydown", (e) => {
      const tag = (document.activeElement?.tagName || "").toLowerCase();
      const typing = tag === "input" || tag === "textarea" || document.activeElement?.isContentEditable;
      if(typing) return;

      if(e.key === " "){
        e.preventDefault();
        if(activeEmbedIndex >= 0) stopEmbed();
        else setActiveEmbed(0, true);
      }
    });

    // ===== SETTINGS (persist) =====
    function loadSetting(key, fallback){
      const v = localStorage.getItem(key);
      return (v === null || v === undefined) ? fallback : v;
    }
    function saveSetting(key, v){
      localStorage.setItem(key, String(v));
    }

    // UI scale
    const uiScale = $("#uiScale");
    const savedScale = loadSetting("krs_uiScale", String(getComputedStyle(root).getPropertyValue("--s").trim()));
    root.style.setProperty("--s", savedScale);
    uiScale.value = savedScale;
    uiScale.addEventListener("input", () => {
      root.style.setProperty("--s", uiScale.value);
      saveSetting("krs_uiScale", uiScale.value);
    });

    // Accent
    const accent = $("#accent");
    const savedAccent = loadSetting("krs_accent", getComputedStyle(root).getPropertyValue("--accent").trim() || "#ffb347");
    root.style.setProperty("--accent", savedAccent);
    accent.value = savedAccent;
    accent.addEventListener("input", () => {
      root.style.setProperty("--accent", accent.value);
      saveSetting("krs_accent", accent.value);
    });

    // Sunrise
    const sunriseOn = $("#sunriseOn");
    const sunrisePower = $("#sunrisePower");

    const savedSunOn = loadSetting("krs_sunriseOn", String(getComputedStyle(root).getPropertyValue("--sunriseOn").trim()));
    const savedSunPow = loadSetting("krs_sunrisePower", String(getComputedStyle(root).getPropertyValue("--sunrisePower").trim()));

    root.style.setProperty("--sunriseOn", savedSunOn);
    root.style.setProperty("--sunrisePower", savedSunPow);

    sunriseOn.value = savedSunOn;
    sunrisePower.value = savedSunPow;

    sunriseOn.addEventListener("input", () => {
      root.style.setProperty("--sunriseOn", sunriseOn.value);
      saveSetting("krs_sunriseOn", sunriseOn.value);
    });
    sunrisePower.addEventListener("input", () => {
      root.style.setProperty("--sunrisePower", sunrisePower.value);
      saveSetting("krs_sunrisePower", sunrisePower.value);
    });

    // Background preset
    const bgPreset = $("#bgPreset");
    const savedBg = loadSetting("krs_bgPreset", document.body.getAttribute("data-bg") || "1");
    document.body.setAttribute("data-bg", savedBg);
    bgPreset.value = savedBg;
    bgPreset.addEventListener("input", () => {
      document.body.setAttribute("data-bg", bgPreset.value);
      saveSetting("krs_bgPreset", bgPreset.value);
    });

    // Rain
    const rainOn = $("#rainOn");
    const rainCount = $("#rainCount");
    const rainLayer = $("#rain");

    const savedRainOn = loadSetting("krs_rainOn", String(getComputedStyle(root).getPropertyValue("--rainOn").trim()));
    const savedRainCount = loadSetting("krs_rainCount", String(getComputedStyle(root).getPropertyValue("--rainCount").trim()));

    root.style.setProperty("--rainOn", savedRainOn);
    root.style.setProperty("--rainCount", savedRainCount);

    rainOn.value = savedRainOn;
    rainCount.value = savedRainCount;

    let rainNodes = [];
    function rebuildRain(){
      // —Å–Ω–µ—Å—Ç–∏ —Å—Ç–∞—Ä—ã–µ
      rainNodes.forEach(n => n.remove());
      rainNodes = [];

      const on = Number(getComputedStyle(root).getPropertyValue("--rainOn").trim()) === 1;
      const count = Number(getComputedStyle(root).getPropertyValue("--rainCount").trim()) || 0;
      if(!on || count <= 0) return;

      const w = window.innerWidth;

      for(let i=0; i<count; i++){
        const d = document.createElement("div");
        d.className = "drop";

        const left = Math.random() * w;
        const dur = 0.65 + Math.random() * 1.05;  // 0.65..1.70
        const delay = Math.random() * 1.3;
        const opacity = 0.10 + Math.random() * 0.26;

        d.style.left = left + "px";
        d.style.animationDuration = dur + "s";
        d.style.animationDelay = delay + "s";
        d.style.opacity = opacity;

        // —á—É—Ç—å —Ä–∞–∑–Ω–∞—è —à–∏—Ä–∏–Ω–∞, —á—Ç–æ–±—ã –≤—ã–≥–ª—è–¥–µ–ª–æ –∂–∏–≤–µ–µ
        const ww = 1 + Math.random() * 1.6;
        d.style.width = ww + "px";

        rainLayer.appendChild(d);
        rainNodes.push(d);
      }
    }

    rainOn.addEventListener("input", () => {
      root.style.setProperty("--rainOn", rainOn.value);
      saveSetting("krs_rainOn", rainOn.value);
      rebuildRain();
    });

    rainCount.addEventListener("input", () => {
      root.style.setProperty("--rainCount", rainCount.value);
      saveSetting("krs_rainCount", rainCount.value);
      rebuildRain();
    });

    window.addEventListener("resize", rebuildRain);

    // –≤–∏–∑—É–∞–ª—å–Ω–∞—è –≥—Ä–æ–º–∫–æ—Å—Ç—å (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ embed)
    const vol = document.querySelector(".vol");
    const volFill = $("#volFill");
    vol.addEventListener("click", (e) => {
      const r = vol.getBoundingClientRect();
      const pct = Math.max(0, Math.min(1, (e.clientX - r.left) / r.width));
      volFill.style.width = Math.round(pct * 100) + "%";
    });

    // ===== START =====
    openPage("home");
    renderEmbedList();
    rebuildRain();
  </script>
</body>
</html>
