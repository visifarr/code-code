<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ö—Ä–∞—Å–∫–∏ –†–∞—Å—Å–≤–µ—Ç–∞ ‚Äî Music Hub</title>

  <style>
    :root{
      --s: 1.10;                  /* –æ–±—â–∏–π –º–∞—Å—à—Ç–∞–± UI */
      --density: 1.00;            /* –ø–ª–æ—Ç–Ω–æ—Å—Ç—å/–∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å (–º–µ–Ω—å—à–µ = –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ) */

      --bg:#070914;
      --panel: rgba(14,16,28,.86);
      --stroke: rgba(255,255,255,.07);
      --text:#f1f3ff;

      --accent:#ffb347;
      --pink:#ff6fae;
      --sky:#6ecbff;

      --r: calc(16px * var(--s));
      --pad: calc(12px * var(--s));
      --gap: calc(12px * var(--s));
      --blur: 12px;

      --playerH: calc(96px * var(--s));

      --sunriseOn: 1;
      --sunrisePower: .74;

      --rainOn: 0;
      --rainCount: 22;            /* —Å–∫–æ–ª—å–∫–æ –∫–∞–ø–µ–ª—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ */
      --bgPreset: 1;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background: var(--bg);
      overflow:hidden;
    }

    /* ===== BACKGROUND PRESETS ===== */
    .bg{
      position:fixed; inset:0; z-index:0;
      background: var(--bg);
    }
    .bg::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(1100px 700px at 18% -10%, color-mix(in srgb, var(--accent) 40%, transparent), transparent 60%),
        radial-gradient(900px 620px at 92% 10%, color-mix(in srgb, var(--sky) 28%, transparent), transparent 62%),
        radial-gradient(800px 520px at 50% 92%, color-mix(in srgb, var(--pink) 22%, transparent), transparent 68%),
        linear-gradient(180deg, rgba(255,255,255,.02), transparent 35%),
        var(--bg);
      filter:saturate(1.08) contrast(1.04);
    }
    body[data-bg="2"] .bg::before{
      background:
        radial-gradient(1000px 700px at 20% 0%, rgba(255,179,71,.30), transparent 60%),
        radial-gradient(980px 520px at 80% 10%, rgba(255,111,174,.22), transparent 62%),
        radial-gradient(900px 520px at 50% 100%, rgba(110,203,255,.18), transparent 68%),
        radial-gradient(700px 380px at 40% 40%, rgba(255,255,255,.03), transparent 70%),
        var(--bg);
    }
    body[data-bg="3"] .bg::before{
      background:
        radial-gradient(1000px 700px at 10% 0%, rgba(110,203,255,.26), transparent 60%),
        radial-gradient(980px 520px at 90% 10%, rgba(255,179,71,.22), transparent 62%),
        radial-gradient(900px 520px at 50% 100%, rgba(255,111,174,.16), transparent 68%),
        linear-gradient(180deg, rgba(255,255,255,.02), transparent 45%),
        var(--bg);
    }
    body[data-bg="4"] .bg::before{
      background:
        radial-gradient(1000px 640px at 30% -10%, rgba(255,111,174,.26), transparent 62%),
        radial-gradient(900px 540px at 75% 10%, rgba(110,203,255,.18), transparent 62%),
        radial-gradient(980px 680px at 50% 110%, rgba(255,179,71,.20), transparent 66%),
        radial-gradient(800px 520px at 20% 60%, rgba(255,255,255,.03), transparent 70%),
        var(--bg);
    }

    /* ===== SUNRISE OVERLAY ===== */
    .sunrise{
      position:fixed; inset:-18%; z-index:1;
      pointer-events:none;
      opacity: calc(var(--sunriseOn) * var(--sunrisePower));
      background:
        radial-gradient(900px 420px at 26% 10%, color-mix(in srgb, var(--accent) 42%, transparent), transparent 62%),
        radial-gradient(780px 380px at 72% 18%, color-mix(in srgb, var(--pink) 34%, transparent), transparent 66%),
        radial-gradient(900px 560px at 50% 100%, color-mix(in srgb, var(--sky) 26%, transparent), transparent 72%);
      animation: sunriseMove 18s ease-in-out infinite;
      filter: blur(.6px);
      transform-origin:50% 50%;
    }
    @keyframes sunriseMove{
      0%   { transform: translate3d(-1.4%, -1.0%, 0) scale(1.02); }
      50%  { transform: translate3d( 1.6%,  1.2%, 0) scale(1.05); }
      100% { transform: translate3d(-1.4%, -1.0%, 0) scale(1.02); }
    }

    /* ===== GLASS DROPLETS (on screen) ===== */
    .rain{
      position:fixed; inset:0; z-index:2;
      pointer-events:none;
      opacity: calc(.95 * var(--rainOn));
      overflow:hidden;
    }
    .droplet{
      position:absolute;
      top:-10vh;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), rgba(255,255,255,.10) 40%, rgba(255,255,255,.02) 65%, transparent 70%),
        radial-gradient(circle at 70% 80%, rgba(140,220,255,.16), transparent 70%);
      box-shadow:
        0 0 0 1px rgba(255,255,255,.05),
        0 12px 30px rgba(0,0,0,.22);
      filter: blur(.2px);
      transform: translateZ(0);
      animation: dropFall linear infinite;
    }
    .droplet::after{
      content:"";
      position:absolute;
      left:50%;
      top:-16px;
      width:2px;
      height:18px;
      transform: translateX(-50%);
      background: linear-gradient(to bottom, transparent, rgba(200,240,255,.20), transparent);
      border-radius:999px;
      opacity:.6;
    }
    @keyframes dropFall{
      to { transform: translateY(135vh) translateZ(0); }
    }

    /* ===== APP ===== */
    .app{
      position:relative;
      z-index:3;
      height:100%;
      display:grid;
      grid-template-columns: calc(270px * var(--s) * var(--density)) 1fr;
      grid-template-rows: 1fr var(--playerH);
      gap: var(--gap);
      padding: var(--pad);
    }

    .panel{
      background: var(--panel);
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      backdrop-filter: blur(var(--blur));
      -webkit-backdrop-filter: blur(var(--blur));
      box-shadow: 0 18px 56px rgba(0,0,0,.58);
      overflow:hidden;
    }

    .sidebar{
      padding: calc(14px * var(--s) * var(--density));
      display:flex;
      flex-direction:column;
      gap: calc(14px * var(--s) * var(--density));
    }
    .logo{
      font-weight: 950;
      font-size: calc(18px * var(--s));
      letter-spacing:.2px;
      background: linear-gradient(90deg, var(--accent), var(--pink));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      user-select:none;
    }
    .nav{
      display:flex;
      flex-direction:column;
      gap: calc(10px * var(--s) * var(--density));
    }
    .nav button{
      width:100%;
      border:none;
      background: transparent;
      color: var(--text);
      padding: calc(12px * var(--s) * var(--density)) calc(12px * var(--s) * var(--density));
      border-radius: calc(12px * var(--s));
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border: 1px solid transparent;
      font-weight: 850;
      font-size: calc(13px * var(--s));
    }
    .nav button:hover{
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.05);
    }
    .nav button.active{
      background: linear-gradient(90deg, color-mix(in srgb, var(--accent) 24%, transparent), color-mix(in srgb, var(--pink) 14%, transparent));
      border-color: color-mix(in srgb, var(--accent) 34%, transparent);
    }
    .k{
      font-size: calc(11px * var(--s));
      color: rgba(255,255,255,.68);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      padding: 3px 8px;
      border-radius: 999px;
      flex:0 0 auto;
    }
    .hint{
      margin-top:auto;
      padding: calc(10px * var(--s) * var(--density));
      border-radius: calc(12px * var(--s));
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.72);
      font-weight: 650;
      font-size: calc(11px * var(--s));
      line-height: 1.35;
    }

    .main{
      display:flex;
      flex-direction:column;
    }
    .topbar{
      padding: calc(12px * var(--s) * var(--density));
      border-bottom: 1px solid rgba(255,255,255,.06);
      display:flex;
      gap: calc(10px * var(--s) * var(--density));
      align-items:center;
    }
    .search{
      flex:1;
      display:flex;
      align-items:center;
      gap: 10px;
      padding: calc(10px * var(--s) * var(--density)) calc(12px * var(--s) * var(--density));
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 999px;
    }
    .search input{
      width:100%;
      border:none;
      outline:none;
      background: transparent;
      color: var(--text);
      font-size: calc(13px * var(--s));
      font-weight: 750;
    }
    .chip{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.90);
      border-radius: 999px;
      padding: calc(9px * var(--s) * var(--density)) calc(12px * var(--s) * var(--density));
      font-weight: 900;
      font-size: calc(12px * var(--s));
      cursor:pointer;
      user-select:none;
    }

    .content{
      padding: calc(14px * var(--s) * var(--density));
      overflow:auto;
    }
    .hero{
      padding: calc(18px * var(--s) * var(--density));
      border-radius: calc(18px * var(--s));
      border: 1px solid rgba(255,255,255,.08);
      background:
        radial-gradient(760px 300px at 24% 0%, color-mix(in srgb, var(--accent) 22%, transparent), transparent 62%),
        radial-gradient(680px 300px at 78% 0%, color-mix(in srgb, var(--sky) 18%, transparent), transparent 66%),
        rgba(255,255,255,.03);
    }
    .hero h1{
      margin:0;
      font-size: calc(22px * var(--s));
      letter-spacing:.2px;
    }
    .hero p{
      margin: 6px 0 0;
      color: rgba(255,255,255,.72);
      font-weight: 650;
      font-size: calc(12px * var(--s));
    }

    .embedBox{
      margin-top: calc(14px * var(--s) * var(--density));
      padding: calc(12px * var(--s) * var(--density));
      border-radius: calc(16px * var(--s));
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }
    .embedBox h3{
      margin: 0 0 10px 0;
      font-size: calc(14px * var(--s));
      font-weight: 950;
    }
    .embedGrid{
      display:grid;
      grid-template-columns: 1fr 1.2fr;
      gap: calc(12px * var(--s) * var(--density));
    }
    .embedList{
      display:flex;
      flex-direction:column;
      gap: calc(10px * var(--s) * var(--density));
    }
    .embedItem{
      padding: calc(10px * var(--s) * var(--density));
      border-radius: calc(14px * var(--s));
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.14);
      cursor:pointer;
      user-select:none;
    }
    .embedItem:hover{ background: rgba(255,255,255,.06); }
    .embedItem.active{
      border-color: color-mix(in srgb, var(--accent) 34%, transparent);
      background: linear-gradient(90deg, color-mix(in srgb, var(--accent) 16%, transparent), rgba(255,255,255,.05));
    }
    .embedItem .t{
      font-weight: 950;
      font-size: calc(13px * var(--s));
      margin-bottom: 4px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .embedItem .d{
      color: rgba(255,255,255,.70);
      font-weight: 650;
      font-size: calc(11px * var(--s));
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .embedStage{
      border-radius: calc(14px * var(--s));
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.18);
      overflow:hidden;
    }
    .embedStage iframe{
      width:100%;
      height: calc(260px * var(--s));
      border:0;
      display:block;
    }

    .settingsGrid{
      margin-top: calc(14px * var(--s));
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: calc(12px * var(--s));
    }
    .group{
      padding: calc(12px * var(--s));
      border-radius: calc(16px * var(--s));
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }
    .group h3{
      margin:0 0 10px 0;
      font-size: calc(14px * var(--s));
      font-weight: 950;
    }
    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      margin-top: 10px;
      color: rgba(255,255,255,.86);
      font-weight: 750;
      font-size: calc(12px * var(--s));
    }
    .row input[type="range"]{ width: 56%; }
    .row input[type="color"]{ width: 46px; height: 34px; border:none; padding:0; background: transparent; }

    .content::-webkit-scrollbar{ width: 10px; }
    .content::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.10);
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,0);
      background-clip: padding-box;
    }

    /* ===== PLAYER ===== */
    .player{
      grid-column: 1 / span 2;
      grid-row:2;
      padding: calc(12px * var(--s) * var(--density)) calc(14px * var(--s) * var(--density));
      display:grid;
      grid-template-columns: 1.2fr 1.2fr 1fr;
      align-items:center;
      gap: calc(12px * var(--s) * var(--density));
    }
    .now{
      display:flex;
      align-items:center;
      gap: calc(10px * var(--s));
      min-width:0;
    }
    .art{
      width: calc(54px * var(--s));
      height: calc(54px * var(--s));
      border-radius: calc(14px * var(--s));
      background: linear-gradient(135deg, rgba(255,255,255,.08), color-mix(in srgb, var(--accent) 22%, transparent));
      border: 1px solid rgba(255,255,255,.10);
      flex:0 0 auto;
    }
    .meta{ min-width:0; }
    .track{
      font-weight: 950;
      font-size: calc(13px * var(--s));
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .artist{
      margin-top: 4px;
      font-weight: 700;
      font-size: calc(11px * var(--s));
      color: rgba(255,255,255,.68);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .ctrls{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: calc(10px * var(--s));
    }
    .btn{
      width: calc(38px * var(--s));
      height: calc(38px * var(--s));
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      cursor:pointer;
      display:grid;
      place-items:center;
      font-weight: 900;
      user-select:none;
    }
    .btn.play{
      width: calc(42px * var(--s));
      height: calc(42px * var(--s));
      background: var(--accent);
      border-color: color-mix(in srgb, var(--accent) 38%, transparent);
      color:#151515;
    }
    .right{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap: calc(10px * var(--s));
    }

    @media (max-width: 980px){
      body{ overflow:auto; }
      .app{ grid-template-columns: 1fr; grid-template-rows: auto 1fr var(--playerH); }
      .player{ grid-template-columns: 1fr; }
      .right{ justify-content:center; }
      .embedGrid{ grid-template-columns: 1fr; }
      .settingsGrid{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body data-bg="1">
  <div class="bg"></div>
  <div class="sunrise"></div>
  <div class="rain" id="rain"></div>

  <div class="app">
    <aside class="panel sidebar">
      <div class="logo">–ö—Ä–∞—Å–∫–∏ –†–∞—Å—Å–≤–µ—Ç–∞</div>
      <div class="nav" id="nav">
        <button class="active" data-page="home">üè† –ì–ª–∞–≤–Ω–∞—è <span class="k">1</span></button>
        <button data-page="search">üîç –ü–æ–∏—Å–∫ <span class="k">2</span></button>
        <button data-page="playlists">üéµ –ü–ª–µ–π–ª–∏—Å—Ç—ã <span class="k">3</span></button>
        <button data-page="library">üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ <span class="k">4</span></button>
        <button data-page="settings">‚öô –ù–∞—Å—Ç—Ä–æ–π–∫–∏ <span class="k">5</span></button>
      </div>
      <div class="hint">
        1‚Äì5 –≤–∫–ª–∞–¥–∫–∏ (–µ—Å–ª–∏ –ø–µ—á–∞—Ç–∞–µ—à—å: Alt+1..5)<br/>
        –°–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤ —É–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∏–∂–Ω–∏–º –±–∞—Ä–æ–º
      </div>
    </aside>

    <main class="panel main">
      <div class="topbar">
        <div class="search">
          <span>üîç</span>
          <input id="searchInput" placeholder="–ü–æ–∏—Å–∫ (–¥–µ–º–æ)" autocomplete="off" />
        </div>
        <div class="chip" id="goSettings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
      </div>

      <div class="content">
        <section id="page-home">
          <div class="hero">
            <h1>–î–æ–º–∞—à–Ω—è—è</h1>
            <p>–°–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤ —Å–Ω–∏–∑—É. –û–¥–∏–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫, –≤—Ç–æ—Ä–æ–π –Ω–µ –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è.</p>
          </div>

          <div class="embedBox">
            <h3>–¢—Ä–µ–∫–∏ (–≤—Å—Ç—Ä–æ–π–∫–∏). –í—ã–±–µ—Ä–∏ ‚Äî –∏ –æ–Ω–æ ‚Äú—Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç—Å—è‚Äù –≤ –Ω–∏–∂–Ω–∏–π –±–∞—Ä</h3>
            <div class="embedGrid">
              <div class="embedList" id="embedList"></div>
              <div class="embedStage" id="embedStage"></div>
            </div>
          </div>
        </section>

        <section id="page-search" style="display:none">
          <div class="hero"><h1>–ü–æ–∏—Å–∫</h1><p>–ü–æ—Ç–æ–º —Å–¥–µ–ª–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π —Å –±–∞–∑–æ–π.</p></div>
        </section>

        <section id="page-playlists" style="display:none">
          <div class="hero"><h1>–ü–ª–µ–π–ª–∏—Å—Ç—ã</h1><p>–ü–æ—Ç–æ–º —Å–¥–µ–ª–∞–µ–º –∫–∞–∫ —É Spotify.</p></div>
        </section>

        <section id="page-library" style="display:none">
          <div class="hero"><h1>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</h1><p>–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ/–ª–∞–π–∫–∏/–∏—Å—Ç–æ—Ä–∏—è –ø–æ–∑–∂–µ.</p></div>
        </section>

        <section id="page-settings" style="display:none">
          <div class="hero"><h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1><p>–ú–∞—Å—à—Ç–∞–±, –ø–ª–æ—Ç–Ω–æ—Å—Ç—å, —Ü–≤–µ—Ç, —Ñ–æ–Ω, —Ä–∞—Å—Å–≤–µ—Ç, –∫–∞–ø–ª–∏.</p></div>

          <div class="settingsGrid">
            <div class="group">
              <h3>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h3>

              <div class="row">
                <span>–ú–∞—Å—à—Ç–∞–± UI</span>
                <input id="uiScale" type="range" min="0.80" max="1.90" step="0.01" value="1.10">
              </div>

              <div class="row">
                <span>–ü–ª–æ—Ç–Ω–æ—Å—Ç—å</span>
                <input id="density" type="range" min="0.85" max="1.15" step="0.01" value="1.00">
              </div>

              <div class="row">
                <span>–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç</span>
                <input id="accent" type="color" value="#ffb347">
              </div>
            </div>

            <div class="group">
              <h3>–§–æ–Ω –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã</h3>

              <div class="row">
                <span>–§–æ–Ω (–ø—Ä–µ—Å–µ—Ç)</span>
                <input id="bgPreset" type="range" min="1" max="4" step="1" value="1">
              </div>

              <div class="row">
                <span>–†–∞—Å—Å–≤–µ—Ç (–≤–∫–ª)</span>
                <input id="sunriseOn" type="range" min="0" max="1" step="1" value="1">
              </div>

              <div class="row">
                <span>–°–∏–ª–∞ —Ä–∞—Å—Å–≤–µ—Ç–∞</span>
                <input id="sunrisePower" type="range" min="0" max="1" step="0.01" value="0.74">
              </div>

              <div class="row">
                <span>–ö–∞–ø–ª–∏ (–≤–∫–ª)</span>
                <input id="rainOn" type="range" min="0" max="1" step="1" value="0">
              </div>

              <div class="row">
                <span>–ö–æ–ª-–≤–æ –∫–∞–ø–µ–ª—å</span>
                <input id="rainCount" type="range" min="0" max="120" step="1" value="22">
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <footer class="panel player">
      <div class="now">
        <div class="art"></div>
        <div class="meta">
          <div class="track" id="trackName">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç—Ä–µ–∫–∞</div>
          <div class="artist" id="artistName">–í—ã–±–µ—Ä–∏ —Ç—Ä–µ–∫ –∏–∑ —Å–ø–∏—Å–∫–∞</div>
        </div>
      </div>

      <div class="ctrls">
        <button class="btn" id="prevBtn">‚èÆ</button>
        <button class="btn play" id="playBtn">‚ñ∂</button>
        <button class="btn" id="nextBtn">‚è≠</button>
        <button class="btn" id="stopBtn">‚èπ</button>
      </div>

      <div class="right">
        <div style="opacity:.7;font-weight:800;font-size:12px;">Embed mode</div>
      </div>
    </footer>
  </div>

  <script>
    const $ = (s) => document.querySelector(s);
    const root = document.documentElement;
    const rainLayer = $("#rain");

    // ===== NAV =====
    const pages = ["home","search","playlists","library","settings"];
    function setActiveNav(name){
      document.querySelectorAll("#nav button").forEach(btn=>{
        btn.classList.toggle("active", btn.dataset.page === name);
      });
    }
    function openPage(name){
      pages.forEach(p=>{
        const el = document.getElementById("page-"+p);
        if(el) el.style.display = (p === name) ? "block" : "none";
      });
      setActiveNav(name);
      if(name === "search") $("#searchInput")?.focus();
    }
    document.querySelectorAll("#nav button").forEach(btn=>{
      btn.addEventListener("click", () => openPage(btn.dataset.page));
    });
    $("#goSettings").addEventListener("click", () => openPage("settings"));

    // –±–∏–Ω–¥—ã 1..5
    document.addEventListener("keydown", (e) => {
      const tag = (document.activeElement?.tagName || "").toLowerCase();
      const typing = tag === "input" || tag === "textarea" || document.activeElement?.isContentEditable;
      if(typing && !e.altKey) return;
      if(e.key === "1") openPage("home");
      if(e.key === "2") openPage("search");
      if(e.key === "3") openPage("playlists");
      if(e.key === "4") openPage("library");
      if(e.key === "5") openPage("settings");
    });

    // ===== EMBEDS (ONE ACTIVE) =====
    const embedItems = [
      { title:"Daft Punk ‚Äî Harder Better Faster Stronger", source:"Spotify Embed", url:"https://open.spotify.com/embed/track/5W3cjX2J3tjhG8zb6u0qHn" },
      { title:"Radiohead ‚Äî Creep", source:"Spotify Embed", url:"https://open.spotify.com/embed/track/70LcF31zb1H0PyJoS1Sx1r" },
      { title:"Never Gonna Give You Up", source:"YouTube Embed", url:"https://www.youtube.com/embed/dQw4w9WgXcQ" },
      { title:"Coldplay ‚Äî Viva La Vida", source:"YouTube Embed", url:"https://www.youtube.com/embed/dvgZkm1xWPE" },
    ];

    const embedList = $("#embedList");
    const embedStage = $("#embedStage");
    let active = -1;

    function renderList(){
      embedList.innerHTML = "";
      embedItems.forEach((it, idx) => {
        const el = document.createElement("div");
        el.className = "embedItem" + (idx===active ? " active" : "");
        el.innerHTML = `<div class="t">${escapeHtml(it.title)}</div><div class="d">${escapeHtml(it.source)}</div>`;
        el.addEventListener("click", () => setActive(idx));
        embedList.appendChild(el);
      });
    }

    function setActive(idx){
      if(idx < 0 || idx >= embedItems.length) return;
      active = idx;

      // –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å—Ç–æ–ø–∞–µ–º –ø—Ä–æ—à–ª–æ–µ: —É–±–∏–≤–∞–µ–º iframe
      embedStage.innerHTML = "";

      const it = embedItems[idx];
      const iframe = document.createElement("iframe");
      iframe.allow = "autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture";
      iframe.loading = "lazy";
      iframe.src = it.url;
      embedStage.appendChild(iframe);

      $("#trackName").textContent = it.title;
      $("#artistName").textContent = it.source;

      renderList();
      $("#playBtn").textContent = "‚ü≤"; // –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
    }

    function stop(){
      embedStage.innerHTML = "";
      active = -1;
      $("#trackName").textContent = "–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ";
      $("#artistName").textContent = "–í—ã–±–µ—Ä–∏ —Ç—Ä–µ–∫ –∏–∑ —Å–ø–∏—Å–∫–∞";
      renderList();
      $("#playBtn").textContent = "‚ñ∂";
    }

    $("#prevBtn").addEventListener("click", () => {
      if(embedItems.length === 0) return;
      const next = (active <= 0) ? (embedItems.length - 1) : (active - 1);
      setActive(next);
    });
    $("#nextBtn").addEventListener("click", () => {
      if(embedItems.length === 0) return;
      const next = (active < 0) ? 0 : ((active + 1) % embedItems.length);
      setActive(next);
    });
    $("#stopBtn").addEventListener("click", stop);
    $("#playBtn").addEventListener("click", () => {
      if(active < 0) setActive(0);
      else setActive(active); // –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
    });

    function escapeHtml(s){
      return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }

    // ===== SETTINGS PERSIST =====
    function load(key, fallback){
      const v = localStorage.getItem(key);
      return (v === null || v === undefined) ? fallback : v;
    }
    function save(key, v){ localStorage.setItem(key, String(v)); }

    // scale
    const uiScale = $("#uiScale");
    const density = $("#density");
    const accent = $("#accent");
    const bgPreset = $("#bgPreset");
    const sunriseOn = $("#sunriseOn");
    const sunrisePower = $("#sunrisePower");
    const rainOn = $("#rainOn");
    const rainCount = $("#rainCount");

    const s0 = load("krs_s", getComputedStyle(root).getPropertyValue("--s").trim() || "1.10");
    const d0 = load("krs_density", getComputedStyle(root).getPropertyValue("--density").trim() || "1.00");
    const a0 = load("krs_accent", getComputedStyle(root).getPropertyValue("--accent").trim() || "#ffb347");
    const b0 = load("krs_bg", document.body.getAttribute("data-bg") || "1");
    const so0 = load("krs_sunOn", getComputedStyle(root).getPropertyValue("--sunriseOn").trim() || "1");
    const sp0 = load("krs_sunPow", getComputedStyle(root).getPropertyValue("--sunrisePower").trim() || "0.74");
    const ro0 = load("krs_rainOn", getComputedStyle(root).getPropertyValue("--rainOn").trim() || "0");
    const rc0 = load("krs_rainCount", getComputedStyle(root).getPropertyValue("--rainCount").trim() || "22");

    root.style.setProperty("--s", s0); uiScale.value = s0;
    root.style.setProperty("--density", d0); density.value = d0;
    root.style.setProperty("--accent", a0); accent.value = a0;
    document.body.setAttribute("data-bg", b0); bgPreset.value = b0;
    root.style.setProperty("--sunriseOn", so0); sunriseOn.value = so0;
    root.style.setProperty("--sunrisePower", sp0); sunrisePower.value = sp0;
    root.style.setProperty("--rainOn", ro0); rainOn.value = ro0;
    root.style.setProperty("--rainCount", rc0); rainCount.value = rc0;

    uiScale.addEventListener("input", () => { root.style.setProperty("--s", uiScale.value); save("krs_s", uiScale.value); });
    density.addEventListener("input", () => { root.style.setProperty("--density", density.value); save("krs_density", density.value); });
    accent.addEventListener("input", () => { root.style.setProperty("--accent", accent.value); save("krs_accent", accent.value); });
    bgPreset.addEventListener("input", () => { document.body.setAttribute("data-bg", bgPreset.value); save("krs_bg", bgPreset.value); });
    sunriseOn.addEventListener("input", () => { root.style.setProperty("--sunriseOn", sunriseOn.value); save("krs_sunOn", sunriseOn.value); });
    sunrisePower.addEventListener("input", () => { root.style.setProperty("--sunrisePower", sunrisePower.value); save("krs_sunPow", sunrisePower.value); });

    // –∫–∞–ø–ª–∏
    let drops = [];
    function rebuildDrops(){
      drops.forEach(d => d.remove());
      drops = [];

      const on = Number(getComputedStyle(root).getPropertyValue("--rainOn").trim()) === 1;
      const count = Number(getComputedStyle(root).getPropertyValue("--rainCount").trim()) || 0;
      if(!on || count <= 0) return;

      const w = window.innerWidth;

      for(let i=0;i<count;i++){
        const d = document.createElement("div");
        d.className = "droplet";

        const left = Math.random() * w;
        const size = 6 + Math.random() * 12;     // 6..18
        const dur = 3.8 + Math.random() * 6.0;   // 3.8..9.8
        const delay = Math.random() * 2.2;
        const op = 0.18 + Math.random() * 0.30;

        d.style.left = left + "px";
        d.style.width = size + "px";
        d.style.height = size + "px";
        d.style.animationDuration = dur + "s";
        d.style.animationDelay = delay + "s";
        d.style.opacity = op;

        rainLayer.appendChild(d);
        drops.push(d);
      }
    }

    rainOn.addEventListener("input", () => {
      root.style.setProperty("--rainOn", rainOn.value);
      save("krs_rainOn", rainOn.value);
      rebuildDrops();
    });

    rainCount.addEventListener("input", () => {
      root.style.setProperty("--rainCount", rainCount.value);
      save("krs_rainCount", rainCount.value);
      rebuildDrops();
    });

    window.addEventListener("resize", rebuildDrops);

    // ===== START =====
    openPage("home");
    renderList();
    rebuildDrops();
  </script>
</body>
</html>
